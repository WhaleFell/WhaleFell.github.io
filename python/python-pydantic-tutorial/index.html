<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico"><title>Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£æ·±å…¥ | ğŸ˜Šè½è½ã®BlogğŸ˜Š</title><meta name="keywords" content="ç¼–ç¨‹,åšå®¢,è®°å½•,æŠ€æœ¯,ç”Ÿæ´»,å‰ç«¯,æ‘„å½±,LGBT,è®¡ç®—æœº,ç½‘ç»œå®‰å…¨,Life,Cybersecurity,Python,Golang,Vue,Javascript,Java,Linux"><meta name="description" content="Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£åº“æ·±å…¥ä¼—æ‰€å‘¨çŸ¥ï¼ŒPython æ˜¯ä¸€é—¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œåœ¨å®šä¹‰å˜é‡æ—¶ä¸ç”¨æ ‡æ³¨å…¶ç±»å‹ï¼Œç±»å‹é—´ä¹Ÿå¯ä»¥éšå½¢çš„è½¬æ¢ã€‚è¿™å¯¼è‡´äº†å¼€å‘æ—¶å€™ IDE æç¤ºä¸æ™ºèƒ½ï¼Œå®¹æ˜“å‡ºç° BUG ç­‰é—®é¢˜ã€‚ JavaScript ä¹Ÿæ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œä½†è¡ç”Ÿå‡ºäº†ä»–çš„è¶…é›† Typescript æ‹¥æœ‰æ›´åŠ å®Œå–„çš„æ³¨é‡Šç³»ç»Ÿã€‚ è€Œ Python3 å¼€å§‹å¯ä»¥æ˜¾æ€§çš„æ·»åŠ  funct"><meta property="og:type" content="article"><meta property="og:title" content="Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£æ·±å…¥"><meta property="og:url" content="https://www.whaleluo.top/python/python-pydantic-tutorial/index.html"><meta property="og:site_name" content="ğŸ˜Šè½è½ã®BlogğŸ˜Š"><meta property="og:description" content="Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£åº“æ·±å…¥ä¼—æ‰€å‘¨çŸ¥ï¼ŒPython æ˜¯ä¸€é—¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œåœ¨å®šä¹‰å˜é‡æ—¶ä¸ç”¨æ ‡æ³¨å…¶ç±»å‹ï¼Œç±»å‹é—´ä¹Ÿå¯ä»¥éšå½¢çš„è½¬æ¢ã€‚è¿™å¯¼è‡´äº†å¼€å‘æ—¶å€™ IDE æç¤ºä¸æ™ºèƒ½ï¼Œå®¹æ˜“å‡ºç° BUG ç­‰é—®é¢˜ã€‚ JavaScript ä¹Ÿæ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œä½†è¡ç”Ÿå‡ºäº†ä»–çš„è¶…é›† Typescript æ‹¥æœ‰æ›´åŠ å®Œå–„çš„æ³¨é‡Šç³»ç»Ÿã€‚ è€Œ Python3 å¼€å§‹å¯ä»¥æ˜¾æ€§çš„æ·»åŠ  funct"><meta property="og:locale"><meta property="article:published_time" content="2023-09-23T16:41:23.000Z"><meta property="article:modified_time" content="2023-09-23T16:41:23.000Z"><meta property="article:author" content="WhaleFall"><meta property="article:tag" content="ç¼–ç¨‹,åšå®¢,è®°å½•,æŠ€æœ¯,ç”Ÿæ´»,å‰ç«¯,æ‘„å½±,LGBT,è®¡ç®—æœº,ç½‘ç»œå®‰å…¨,Life,Cybersecurity,Python,Golang,Vue,Javascript,Java,Linux"><meta name="twitter:card" content="images&#x2F;favicon.ico"><link rel="stylesheet" href="/css/style/main.css"><link rel="stylesheet" id="hl-default-theme" href="https://api.whaleluo.top/file/?url=https://cdn.jsdelivr.net/npm/highlight.js@10.1.2/styles/atom-one-light.css" media="none"><link rel="stylesheet" id="hl-dark-theme" href="https://api.whaleluo.top/file/?url=https://cdn.jsdelivr.net/npm/highlight.js@10.1.2/styles/atom-one-dark.css" media="none"><link rel="stylesheet" href="/css/style/dark.css"><script src="/js/darkmode.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="google-site-verification" content="bka9Mdyvo7g1v-jQq8CzqcaY9zE2QGltMwsvO63rAUw"><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="ğŸ˜Šè½è½ã®BlogğŸ˜Š" type="application/atom+xml"></head><body><div id="app" tabindex="-1"><header class="header"><div class="header__left"><a href="/" class="button"><span class="logo__text">è½è½ã®Blog</span></a></div><div class="header__right"><div class="navbar__menus"><a href="/" class="navbar-menu button">é¦–é¡µ</a> <a href="/tags/" class="navbar-menu button">æ ‡ç­¾</a> <a href="/archives/" class="navbar-menu button">å½’æ¡£</a> <a href="/categories/" class="navbar-menu button">ä¸»é¢˜</a> <a href="/friends/" class="navbar-menu button">å‹é“¾</a> <a href="/about/" class="navbar-menu button">å…³äº</a> <a href="/event/" class="navbar-menu button">å¤§äº‹è®°</a> <a href="/atom.xml" class="navbar-menu button">RSS</a></div><a href="/search/" id="btn-search"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="24" height="24" fill="currentColor" stroke="currentColor" stroke-width="32"><path d="M192 448c0-141.152 114.848-256 256-256s256 114.848 256 256-114.848 256-256 256-256-114.848-256-256z m710.624 409.376l-206.88-206.88A318.784 318.784 0 0 0 768 448c0-176.736-143.264-320-320-320S128 271.264 128 448s143.264 320 320 320a318.784 318.784 0 0 0 202.496-72.256l206.88 206.88 45.248-45.248z"></path></svg> </a><a href="javaScript:void(0);" id="btn-toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> </a><a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="24" height="24" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a><div class="dropdown-menus" id="dropdown-menus"><a href="/" class="dropdown-menu button">é¦–é¡µ</a> <a href="/tags/" class="dropdown-menu button">æ ‡ç­¾</a> <a href="/archives/" class="dropdown-menu button">å½’æ¡£</a> <a href="/categories/" class="dropdown-menu button">ä¸»é¢˜</a> <a href="/friends/" class="dropdown-menu button">å‹é“¾</a> <a href="/about/" class="dropdown-menu button">å…³äº</a> <a href="/event/" class="dropdown-menu button">å¤§äº‹è®°</a> <a href="/atom.xml" class="dropdown-menu button">RSS</a></div></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£æ·±å…¥</h1><div class="post-title__meta"><a href="/archives/2023/09/" class="post-meta__date button">2023-09-24</a> <span id="busuanzi_container_page_pv" hidden><span class="separate-dot"></span> <span></span> <span id="busuanzi_value_page_pv"></span> <span>Views</span></span></div></div><aside class="post-side"><div class="post-side__toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.</span> <span class="toc-text">Reference</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vscode-Support-Pydantic"><span class="toc-number">2.</span> <span class="toc-text">Vscode Support Pydantic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callable-%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E6%B3%A8%E9%87%8A"><span class="toc-number">3.</span> <span class="toc-text">Callable å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generics-d%CA%92%C9%99%CB%88ner-%C9%AAk-adj-%E4%B8%80%E8%88%AC%E7%9A%84-%E6%B3%9B%E5%9E%8B%E6%94%AF%E6%8C%81"><span class="toc-number">4.</span> <span class="toc-text">Generics &#x2F;dÊ’É™Ëˆner.Éªk&#x2F; (adj.ä¸€èˆ¬çš„) æ³›å‹æ”¯æŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#User-defined-Generics-types-%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E6%B3%9B%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">User-defined Generics types ç”¨æˆ·å®šä¹‰çš„æ³›å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annotating-%CB%88aen-%C9%99-te%C9%AAt-v-%E7%BB%99-%E6%B3%A8%E8%A7%A3-tuples-%E6%B3%A8%E9%87%8A%E5%85%83%E7%BB%84"><span class="toc-number">5.</span> <span class="toc-text">Annotating &#x2F;ËˆÃ¦n.É™.teÉªt&#x2F; (v. ç»™..æ³¨è§£) tuples æ³¨é‡Šå…ƒç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Order-Typing-Type-%E5%85%B6%E4%BB%96%E6%B3%A8%E9%87%8A%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">Order Typing Type å…¶ä»–æ³¨é‡Šç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Union-%E8%81%94%E5%90%88"><span class="toc-number">6.1.</span> <span class="toc-text">Union è”åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Optional-%E5%8F%AF%E9%80%89"><span class="toc-number">6.2.</span> <span class="toc-text">Optional å¯é€‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Annotated-aen%C9%99-teitid-%E6%B3%A8%E9%87%8A"><span class="toc-number">6.3.</span> <span class="toc-text">Annotated &#x2F;&#39;Ã¦nÉ™,teitid&#x2F; æ³¨é‡Š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequence-%E8%8B%B1-%CB%88si%CB%90kw%C9%99ns-%E5%BA%8F%E5%88%97-Iterable-%E5%8F%AF%E8%BF%AD%E4%BB%A3-Iterator-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">7.</span> <span class="toc-text">Sequence[è‹± &#x2F;ËˆsiËkwÉ™ns&#x2F; åºåˆ—], Iterable (å¯è¿­ä»£) &amp; Iterator (è¿­ä»£å™¨)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Infinite-%E8%8B%B1-%CB%88%C9%AAnf%C9%AAn%C9%99t-%E6%97%A0%E9%99%90-Generators-%E6%97%A0%E9%99%90%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">Infinite[è‹± &#x2F;ËˆÉªnfÉªnÉ™t&#x2F; æ— é™] Generators æ— é™ç”Ÿæˆå™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pydantic-BaseModel"><span class="toc-number">8.</span> <span class="toc-text">Pydantic BaseModel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Validator-%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="toc-number">8.1.</span> <span class="toc-text">Validator éªŒè¯å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-%E8%8B%B1-fi-ld-%E5%AD%97%E6%AE%B5"><span class="toc-number">8.2.</span> <span class="toc-text">Field [è‹± &#x2F;fi:ld&#x2F; å­—æ®µ]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-Serialization-%E8%8B%B1-%CB%88s%C9%AA%C9%99ri-%C9%99%CB%8Cla%C9%AAz"><span class="toc-number">8.3.</span> <span class="toc-text">åºåˆ—åŒ– Serialization [è‹± &#x2F;ËˆsÉªÉ™ri:É™ËŒlaÉªz&#x2F;]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Read-Environment-value-IN-BaseSettings-%E4%BD%BF%E7%94%A8-Pydantic-%E7%AE%A1%E7%90%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">9.</span> <span class="toc-text">Read Environment value IN BaseSettings ä½¿ç”¨ Pydantic ç®¡ç†ç¯å¢ƒå˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-env-%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD"><span class="toc-number">9.1.</span> <span class="toc-text">é€šè¿‡ .env æ–‡ä»¶åŠ è½½</span></a></li></ol></li></ol></div></aside><a class="btn-toc button" id="btn-toc" tabindex="0"><svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg"><path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path></svg></a><div class="toc-menus" id="toc-menus"><div class="toc-title">Article Directory</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">1.</span> <span class="toc-text">Reference</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vscode-Support-Pydantic"><span class="toc-number">2.</span> <span class="toc-text">Vscode Support Pydantic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callable-%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E6%B3%A8%E9%87%8A"><span class="toc-number">3.</span> <span class="toc-text">Callable å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generics-d%CA%92%C9%99%CB%88ner-%C9%AAk-adj-%E4%B8%80%E8%88%AC%E7%9A%84-%E6%B3%9B%E5%9E%8B%E6%94%AF%E6%8C%81"><span class="toc-number">4.</span> <span class="toc-text">Generics &#x2F;dÊ’É™Ëˆner.Éªk&#x2F; (adj.ä¸€èˆ¬çš„) æ³›å‹æ”¯æŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#User-defined-Generics-types-%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E6%B3%9B%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">User-defined Generics types ç”¨æˆ·å®šä¹‰çš„æ³›å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annotating-%CB%88aen-%C9%99-te%C9%AAt-v-%E7%BB%99-%E6%B3%A8%E8%A7%A3-tuples-%E6%B3%A8%E9%87%8A%E5%85%83%E7%BB%84"><span class="toc-number">5.</span> <span class="toc-text">Annotating &#x2F;ËˆÃ¦n.É™.teÉªt&#x2F; (v. ç»™..æ³¨è§£) tuples æ³¨é‡Šå…ƒç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Order-Typing-Type-%E5%85%B6%E4%BB%96%E6%B3%A8%E9%87%8A%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">Order Typing Type å…¶ä»–æ³¨é‡Šç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Union-%E8%81%94%E5%90%88"><span class="toc-number">6.1.</span> <span class="toc-text">Union è”åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Optional-%E5%8F%AF%E9%80%89"><span class="toc-number">6.2.</span> <span class="toc-text">Optional å¯é€‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Annotated-aen%C9%99-teitid-%E6%B3%A8%E9%87%8A"><span class="toc-number">6.3.</span> <span class="toc-text">Annotated &#x2F;&#39;Ã¦nÉ™,teitid&#x2F; æ³¨é‡Š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sequence-%E8%8B%B1-%CB%88si%CB%90kw%C9%99ns-%E5%BA%8F%E5%88%97-Iterable-%E5%8F%AF%E8%BF%AD%E4%BB%A3-Iterator-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">7.</span> <span class="toc-text">Sequence[è‹± &#x2F;ËˆsiËkwÉ™ns&#x2F; åºåˆ—], Iterable (å¯è¿­ä»£) &amp; Iterator (è¿­ä»£å™¨)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Infinite-%E8%8B%B1-%CB%88%C9%AAnf%C9%AAn%C9%99t-%E6%97%A0%E9%99%90-Generators-%E6%97%A0%E9%99%90%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">Infinite[è‹± &#x2F;ËˆÉªnfÉªnÉ™t&#x2F; æ— é™] Generators æ— é™ç”Ÿæˆå™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pydantic-BaseModel"><span class="toc-number">8.</span> <span class="toc-text">Pydantic BaseModel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Validator-%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="toc-number">8.1.</span> <span class="toc-text">Validator éªŒè¯å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-%E8%8B%B1-fi-ld-%E5%AD%97%E6%AE%B5"><span class="toc-number">8.2.</span> <span class="toc-text">Field [è‹± &#x2F;fi:ld&#x2F; å­—æ®µ]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-Serialization-%E8%8B%B1-%CB%88s%C9%AA%C9%99ri-%C9%99%CB%8Cla%C9%AAz"><span class="toc-number">8.3.</span> <span class="toc-text">åºåˆ—åŒ– Serialization [è‹± &#x2F;ËˆsÉªÉ™ri:É™ËŒlaÉªz&#x2F;]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Read-Environment-value-IN-BaseSettings-%E4%BD%BF%E7%94%A8-Pydantic-%E7%AE%A1%E7%90%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">9.</span> <span class="toc-text">Read Environment value IN BaseSettings ä½¿ç”¨ Pydantic ç®¡ç†ç¯å¢ƒå˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-env-%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD"><span class="toc-number">9.1.</span> <span class="toc-text">é€šè¿‡ .env æ–‡ä»¶åŠ è½½</span></a></li></ol></li></ol></div><article class="post post__with-toc content-card"><div class="post__header"><div class="post__expire" id="post-expired-notify"><p>This article was last updated on &lt;span id=&#34;expire-date&#34;&gt;&lt;/span&gt; days ago, the information described in the article may be outdated.</p></div><script>(() => {
            var update = Date.parse("2023-09-24"),
                date = new Date(),
                now = date.getTime(),
                expire = now - update,
                expire_days = Math.floor(expire/(24*3600*1000));
            if (expire_days >= 120) {
                document.querySelectorAll('#expire-date')[0].innerHTML = expire_days;
                document.querySelectorAll('#post-expired-notify')[0].style.display = 'block';
            }
        })();</script></div><div class="post__content"><h1 id="Pydantic-Typing-â€”â€”-Python-ç±»å‹æ³¨è§£åº“æ·±å…¥"><a href="#Pydantic-Typing-â€”â€”-Python-ç±»å‹æ³¨è§£åº“æ·±å…¥" class="headerlink" title="Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£åº“æ·±å…¥"></a>Pydantic &amp; Typing â€”â€” Python ç±»å‹æ³¨è§£åº“æ·±å…¥</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒPython æ˜¯ä¸€é—¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œåœ¨å®šä¹‰å˜é‡æ—¶ä¸ç”¨æ ‡æ³¨å…¶ç±»å‹ï¼Œç±»å‹é—´ä¹Ÿå¯ä»¥éšå½¢çš„è½¬æ¢ã€‚è¿™å¯¼è‡´äº†å¼€å‘æ—¶å€™ IDE æç¤ºä¸æ™ºèƒ½ï¼Œå®¹æ˜“å‡ºç° BUG ç­‰é—®é¢˜ã€‚</p><p>JavaScript ä¹Ÿæ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œä½†è¡ç”Ÿå‡ºäº†ä»–çš„è¶…é›† Typescript æ‹¥æœ‰æ›´åŠ å®Œå–„çš„æ³¨é‡Šç³»ç»Ÿã€‚</p><p>è€Œ Python3 å¼€å§‹å¯ä»¥æ˜¾æ€§çš„æ·»åŠ  function hint ç±»ä¼¼ï¼š<code>def cat(age: int, name: str) -&gt; str</code> ç­‰ç®€å•çš„ç±»å‹ï¼Œä½†ç¨å¾®å¤æ‚çš„ç±»å‹å°±éœ€è¦ç”¨åˆ° <code>typing</code> ç­‰æ¨¡å—ã€‚</p><p>è€Œ <code>Pydantic</code> å°±è§£å†³äº†è¿™ä¸ªç—›ç‚¹ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå¤æ‚çš„ç±»å‹ï¼Œé›†æˆäº† <strong>æ•°æ®éªŒè¯ï¼ŒIDE æ™ºèƒ½æç¤ºã€Json æ”¯æŒ</strong> ï¼Œç­‰åŠŸèƒ½ï¼Œæé«˜å¼€å‘ä½“éªŒï¼Œå‡å°‘ BUGã€‚</p><p><strong>ç›®å‰ <code>Pydantic</code> å·²ä» V1 å‡çº§æˆ V2 ç›¸å…³ä»£ç è¯·ä¿®æ”¹å¹¶é€‚é…</strong></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Pydantic Official Documentï¼š<a target="_blank" rel="noopener" href="https://docs.pydantic.dev/latest/">Welcome to Pydantic - Pydantic</a> <a target="_blank" rel="noopener" href="https://docs.pydantic.dev/latest/usage/models/">Models - Pydantic</a></p><p>Python <code>Typing</code> Official Documentï¼š<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/typing.html">typing â€” Support for type hints â€” Python 3.11.5 documentation</a></p><h2 id="Vscode-Support-Pydantic"><a href="#Vscode-Support-Pydantic" class="headerlink" title="Vscode Support Pydantic"></a>Vscode Support Pydantic</h2><p>ä½¿ç”¨ VS Code çš„ <strong>Pylance</strong> æ‰©å±•ã€‚å®ƒæ˜¯æ¨èçš„ä¸‹ä¸€ä»£ Python å®˜æ–¹ VS Code æ’ä»¶ã€‚</p><ul><li>Open the â€œUser Settingsâ€<br>æ‰“å¼€â€œç”¨æˆ·è®¾ç½®â€</li><li>Search forÂ <code>Type Checking Mode</code><br>æœç´¢Â <code>Type Checking Mode</code></li><li>You will find an option underÂ <code>Python â€º Analysis: Type Checking Mode</code><br>æ‚¨å°†åœ¨Â <code>Python â€º Analysis: Type Checking Mode</code>Â ä¸‹æ‰¾åˆ°ä¸€ä¸ªé€‰é¡¹</li><li>Set it toÂ <code>basic</code>Â orÂ <code>strict</code>Â (by default itâ€™sÂ <code>off</code>)<br>å°†å…¶è®¾ç½®ä¸ºÂ <code>basic</code>Â æˆ–Â <code>strict</code>Â ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºÂ <code>off</code>Â ï¼‰</li></ul><h2 id="Callable-å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š"><a href="#Callable-å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š" class="headerlink" title="Callable å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š"></a>Callable å›è°ƒå‡½æ•°ç­¾åæ³¨é‡Š</h2><p><code>Callable[[int],Â str]</code>Â è¡¨ç¤ºé‡‡ç”¨Â <code>int</code>Â ç±»å‹çš„å•ä¸ªå‚æ•°å¹¶è¿”å›Â <code>str</code>Â çš„å‡½æ•°ï¼Œä¾‹å¦‚å¯ä»¥æ³¨é‡Šä»¥ä¸‹å‡½æ•°ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>: ...</code></pre><p>ç¤ºä¾‹ï¼š</p><pre><code class="hljs python"><span class="hljs-comment"># Awaitable: å¯ç­‰å¾…å¯¹è±¡</span>
<span class="hljs-keyword">from</span> collections.abc <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>, Awaitable

<span class="hljs-keyword">def</span> <span class="hljs-title function_">feeder</span>(<span class="hljs-params">get_next_item: <span class="hljs-type">Callable</span>[[], <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    â€¦  <span class="hljs-comment"># Body</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">async_query</span>(<span class="hljs-params">on_success: <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">int</span>], <span class="hljs-literal">None</span>],</span>
<span class="hljs-params">                on_error: <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">int</span>, Exception], <span class="hljs-literal">None</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    â€¦  <span class="hljs-comment"># Body</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_update</span>(<span class="hljs-params">value: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
    â€¦  <span class="hljs-comment"># Body</span>

callback: <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">str</span>], Awaitable[<span class="hljs-literal">None</span>]] = on_update</code></pre><h2 id="Generics-dÊ’É™Ëˆner-Éªk-adj-ä¸€èˆ¬çš„-æ³›å‹æ”¯æŒ"><a href="#Generics-dÊ’É™Ëˆner-Éªk-adj-ä¸€èˆ¬çš„-æ³›å‹æ”¯æŒ" class="headerlink" title="Generics /dÊ’É™Ëˆner.Éªk/ (adj.ä¸€èˆ¬çš„) æ³›å‹æ”¯æŒ"></a>Generics <code>/dÊ’É™Ëˆner.Éªk/</code> (adj.ä¸€èˆ¬çš„) æ³›å‹æ”¯æŒ</h2><blockquote><p>æ³›å‹æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ç‰¹æ€§ï¼Œå…è®¸åœ¨ç¼–å†™ä»£ç æ—¶ä½¿ç”¨ <strong>ä¸€äº›é€šç”¨çš„ç±»å‹</strong>ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„ç±»å‹ã€‚å®ƒå¯ä»¥è®©ä»£ç æ›´åŠ é€šç”¨ã€å¯é‡ç”¨å’Œå®‰å…¨ã€‚<br>æ¯”å¦‚ <code>def func(parameter:T) -&gt; T</code> T å°±æ˜¯ä¸€ä¸ªæ³›å‹ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¥å†³å®šä¼ å‡ºçš„å‚æ•°ç±»å‹ï¼Œè€Œä¸æŒ‡å®šä¼ å…¥æ˜¯æŸä¸ªç±»å‹ã€‚</p></blockquote><p>Python æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå®ƒæ²¡æœ‰åƒ Java æˆ– C# é‚£æ ·çš„ä¸¥æ ¼ç±»å‹é™åˆ¶ã€‚å› æ­¤ï¼ŒPython ä¸­çš„æ³›å‹å¹¶ä¸åƒ Java æˆ– C# ä¸­é‚£æ ·æ˜¾å¼åœ°å®šä¹‰ç±»å‹å‚æ•°ã€‚ä½†æ˜¯ï¼ŒPython ä¸­å¯ä»¥ä½¿ç”¨ <strong>æ³›å‹ç¼–ç¨‹æŠ€æœ¯</strong> æ¥å®ç°é€šç”¨ã€å¯é‡ç”¨çš„ä»£ç ã€‚</p><p><code>TypeVar()</code> å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/typing.html#typing.TypeVar">typing â€” Support for type hints â€” Python 3.11.5 documentation</a></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypeVar, <span class="hljs-type">List</span>


T = TypeVar(<span class="hljs-string">&#x27;T&#x27;</span>)  <span class="hljs-comment"># å®šä¹‰æ³›å‹ç±»å‹å˜é‡ T T å¯ä»¥æ˜¯ Any ä»»ä½•ç±»å‹</span>
S = TypeVar(<span class="hljs-string">&#x27;S&#x27;</span>, bound=<span class="hljs-built_in">str</span>)  <span class="hljs-comment"># å¯ä»¥æ˜¯ str çš„ä»»ä½•å­ç±»å‹</span>
A = TypeVar(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-built_in">str</span>, <span class="hljs-built_in">bytes</span>)  <span class="hljs-comment"># å¿…é¡»æ˜¯ str æˆ–è€… bytes ç›¸å½“äº Union[str, bytes]</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">x: T, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[T]:
    <span class="hljs-keyword">return</span> [x] * n

s = repeat(<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># s çš„ç±»å‹ä¸º List[str]</span>
n = repeat(<span class="hljs-number">42</span>, <span class="hljs-number">4</span>)  <span class="hljs-comment"># n çš„ç±»å‹ä¸º List[int]</span></code></pre><h3 id="User-defined-Generics-types-ç”¨æˆ·å®šä¹‰çš„æ³›å‹"><a href="#User-defined-Generics-types-ç”¨æˆ·å®šä¹‰çš„æ³›å‹" class="headerlink" title="User-defined Generics types ç”¨æˆ·å®šä¹‰çš„æ³›å‹"></a>User-defined Generics types ç”¨æˆ·å®šä¹‰çš„æ³›å‹</h3><p><code>TypeVar()</code> åªæ”¯æŒ bound ç»‘å®šä¸€ä¸ªæ ‡å‡†ç±»å‹ï¼Œè€Œ <code>Generic</code> æ”¯æŒç»‘å®šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypeVar, <span class="hljs-type">Generic</span>
<span class="hljs-keyword">from</span> logging <span class="hljs-keyword">import</span> Logger

T = TypeVar(<span class="hljs-string">&#x27;T&#x27;</span>)

<span class="hljs-comment"># ç”¨æˆ·å®šä¹‰çš„ç±»å¯ä»¥å®šä¹‰ä¸ºæ³›å‹ç±»ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggedVar</span>(<span class="hljs-type">Generic</span>[T]):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value: T, name: <span class="hljs-built_in">str</span>, logger: Logger</span>) -&gt; <span class="hljs-literal">None</span>:
        self.name = name
        self.logger = logger
        self.value = value

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">self, new: T</span>) -&gt; <span class="hljs-literal">None</span>:
        self.log(<span class="hljs-string">&#x27;Set &#x27;</span> + <span class="hljs-built_in">repr</span>(self.value))
        self.value = new

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>) -&gt; T:
        self.log(<span class="hljs-string">&#x27;Get &#x27;</span> + <span class="hljs-built_in">repr</span>(self.value))
        <span class="hljs-keyword">return</span> self.value

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        self.logger.info(<span class="hljs-string">&#x27;%s: %s&#x27;</span>, self.name, message)</code></pre><h2 id="Annotating-Ëˆaen-É™-teÉªt-v-ç»™-æ³¨è§£-tuples-æ³¨é‡Šå…ƒç»„"><a href="#Annotating-Ëˆaen-É™-teÉªt-v-ç»™-æ³¨è§£-tuples-æ³¨é‡Šå…ƒç»„" class="headerlink" title="Annotating /ËˆÃ¦n.É™.teÉªt/ (v. ç»™..æ³¨è§£) tuples æ³¨é‡Šå…ƒç»„"></a>Annotating <code>/ËˆÃ¦n.É™.teÉªt/</code> (v. ç»™..æ³¨è§£) tuples æ³¨é‡Šå…ƒç»„</h2><p>åœ¨ Python ä¸­ï¼Œç±»å‹ç³»ç»Ÿéƒ½å‡å®šå®¹å™¨çš„æ•°æ®ç±»å‹ä¸€æ ·ï¼Œå¦‚ <code>List[str]</code> ï¼Œä½† <code>Mapping</code> å¯ä»¥æ”¯æŒå¤šç§ç±»å‹çš„å®¹å™¨ã€‚</p><p><code>Mapping</code>Â åªæ¥å—ä¸¤ä¸ªç±»å‹å‚æ•°ï¼š<strong>ç¬¬ä¸€ä¸ªè¡¨ç¤ºé”®çš„ç±»å‹</strong>ï¼Œ<strong>ç¬¬äºŒä¸ªè¡¨ç¤ºå€¼çš„ç±»å‹</strong>ã€‚</p><p><code>Mapping</code> ç±»ä¼¼äº <code>Dict</code> å­—å…¸</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections.abc <span class="hljs-keyword">import</span> Mapping

x: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>] = []

<span class="hljs-comment"># Type checker error: ``list`` only accepts a single type argument:</span>
y: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">str</span>] = [<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;foo&#x27;</span>]

<span class="hljs-comment"># Type checker will infer that all keys in ``z`` are meant to be strings,</span>
<span class="hljs-comment"># and that all values in ``z`` are meant to be either strings or ints</span>
z: Mapping[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span> | <span class="hljs-built_in">int</span>] = &#123;
 <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;cherry&quot;</span>,
 <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-built_in">int</span>
&#125;</code></pre><p><code>tuple</code> ç±»å‹å¤©ç”Ÿæ”¯æŒå¤šä¸ªå‚æ•°ï¼š</p><pre><code class="hljs python"><span class="hljs-comment"># OK: ``x`` is assigned to a tuple of length 1 where the sole element is an int</span>
x: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>] = (<span class="hljs-number">5</span>,)

<span class="hljs-comment"># OK: ``y`` is assigned to a tuple of length 2;</span>
<span class="hljs-comment"># element 1 is an int, element 2 is a str</span>
y: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">str</span>] = (<span class="hljs-number">5</span>, <span class="hljs-string">&quot;foo&quot;</span>)

<span class="hljs-comment"># OK: çœç•¥å·è¡¨ç¤ºæ¥æ”¶Nä¸ª int å‚æ•°</span>
z: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, ...] = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)</code></pre><h2 id="Order-Typing-Type-å…¶ä»–æ³¨é‡Šç±»å‹"><a href="#Order-Typing-Type-å…¶ä»–æ³¨é‡Šç±»å‹" class="headerlink" title="Order Typing Type å…¶ä»–æ³¨é‡Šç±»å‹"></a>Order Typing Type å…¶ä»–æ³¨é‡Šç±»å‹</h2><h3 id="Union-è”åˆ"><a href="#Union-è”åˆ" class="headerlink" title="Union è”åˆ"></a>Union è”åˆ</h3><p><code>Union[X,Â Y]</code>Â ç›¸å½“äºÂ <code>XÂ |Â Y</code>Â ï¼Œè¡¨ç¤º X æˆ– Yã€‚</p><p>ç‰ˆæœ¬ Python 3.10 ä¸­æ›´æ”¹ï¼šè”åˆç°åœ¨å¯ä»¥å†™ä¸ºÂ <code>XÂ |Â Y</code></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span>

num: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>] = <span class="hljs-string">&quot;1212&quot;</span> <span class="hljs-comment"># OK!</span>
num: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>] = <span class="hljs-number">1212</span> <span class="hljs-comment"># OK!</span>

<span class="hljs-comment"># in &gt;= Python3.10</span>
num: <span class="hljs-built_in">str</span> | <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;1212&quot;</span> <span class="hljs-comment"># ä½¿ç”¨ | è¡¨ç¤ºæˆ–è¿ç®—</span>
</code></pre><h3 id="Optional-å¯é€‰"><a href="#Optional-å¯é€‰" class="headerlink" title="Optional å¯é€‰"></a>Optional å¯é€‰</h3><p><code>Optional[X]</code>Â ç›¸å½“äºÂ <code>XÂ |Â None</code>Â ï¼ˆæˆ–Â <code>Union[X,Â None]</code>Â ï¼‰ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">arg: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-literal">None</span>:</code></pre><h3 id="Annotated-aenÉ™-teitid-æ³¨é‡Š"><a href="#Annotated-aenÉ™-teitid-æ³¨é‡Š" class="headerlink" title="Annotated /&#39;Ã¦nÉ™,teitid/ æ³¨é‡Š"></a>Annotated <code>/&#39;Ã¦nÉ™,teitid/</code> æ³¨é‡Š</h3><p>è¿™ä¸ªåœ¨ FastAPI ä¸­æ·»åŠ  router æ³¨é‡Šç”¨çš„å¤šã€‚ç”¨äºå°† metadata å…ƒæ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªç±»å‹ä¸­çš„ <code>__metadata__</code> å±æ€§ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated
<span class="hljs-comment"># æ¥æ”¶å¯å˜å‚æ•°ï¼Œæ”¯æŒå®šä¹‰å¤šä¸ªå…ƒæ•°æ®</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>X = Annotated[<span class="hljs-built_in">int</span>, <span class="hljs-string">&quot;very&quot;</span>, <span class="hljs-string">&quot;important&quot;</span>, <span class="hljs-string">&quot;metadata&quot;</span>]
<span class="hljs-meta">&gt;&gt;&gt; </span>X
typing.Annotated[<span class="hljs-built_in">int</span>, <span class="hljs-string">&#x27;very&#x27;</span>, <span class="hljs-string">&#x27;important&#x27;</span>, <span class="hljs-string">&#x27;metadata&#x27;</span>]
<span class="hljs-meta">&gt;&gt;&gt; </span>X.__metadata__
(<span class="hljs-string">&#x27;very&#x27;</span>, <span class="hljs-string">&#x27;important&#x27;</span>, <span class="hljs-string">&#x27;metadata&#x27;</span>)


<span class="hljs-comment"># @dataclass æŒ‡æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå‚¨å­˜æ•°æ®çš„ç±»</span>
<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ctype</span>:
    kind: <span class="hljs-built_in">str</span>


<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueRange</span>:
    lo: <span class="hljs-built_in">int</span>
    hi: <span class="hljs-built_in">int</span>

Annotated[<span class="hljs-built_in">int</span>, ValueRange(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>), ctype(<span class="hljs-string">&quot;char&quot;</span>)]</code></pre><h2 id="Sequence-è‹±-ËˆsiËkwÉ™ns-åºåˆ—-Iterable-å¯è¿­ä»£-Iterator-è¿­ä»£å™¨"><a href="#Sequence-è‹±-ËˆsiËkwÉ™ns-åºåˆ—-Iterable-å¯è¿­ä»£-Iterator-è¿­ä»£å™¨" class="headerlink" title="Sequence[è‹± &#x2F;ËˆsiËkwÉ™ns&#x2F; åºåˆ—], Iterable (å¯è¿­ä»£) &amp; Iterator (è¿­ä»£å™¨)"></a>Sequence[è‹± &#x2F;ËˆsiËkwÉ™ns&#x2F; åºåˆ—], Iterable (å¯è¿­ä»£) &amp; Iterator (è¿­ä»£å™¨)</h2><pre><code class="hljs python"><span class="hljs-comment"># Sequence</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Sequence</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    sequence_of_ints: <span class="hljs-type">Sequence</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span>
<span class="hljs-built_in">print</span>(Model(sequence_of_ints=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]).sequence_of_ints)
<span class="hljs-comment">#&gt; [1, 2, 3, 4]</span>
<span class="hljs-built_in">print</span>(Model(sequence_of_ints=(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)).sequence_of_ints)
<span class="hljs-comment">#&gt; (1, 2, 3, 4)</span></code></pre><h3 id="Infinite-è‹±-ËˆÉªnfÉªnÉ™t-æ— é™-Generators-æ— é™ç”Ÿæˆå™¨"><a href="#Infinite-è‹±-ËˆÉªnfÉªnÉ™t-æ— é™-Generators-æ— é™ç”Ÿæˆå™¨" class="headerlink" title="Infinite[è‹± &#x2F;ËˆÉªnfÉªnÉ™t&#x2F; æ— é™] Generators æ— é™ç”Ÿæˆå™¨"></a>Infinite[è‹± &#x2F;ËˆÉªnfÉªnÉ™t&#x2F; æ— é™] Generators æ— é™ç”Ÿæˆå™¨</h3><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Iterable <span class="hljs-comment"># å¯è¿­ä»£å¯¹è±¡</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    infinite: Iterable[<span class="hljs-built_in">int</span>]


<span class="hljs-keyword">def</span> <span class="hljs-title function_">infinite_ints</span>():
 <span class="hljs-comment"># æ— é™ç”Ÿæˆå™¨ Infinite Generators</span>
    i = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">yield</span> i
        i += <span class="hljs-number">1</span>


<span class="hljs-comment"># åœ¨åˆå§‹éªŒè¯æœŸé—´ï¼ŒÂ `Iterable`Â å­—æ®µä»…æ‰§è¡Œç®€å•çš„æ£€æŸ¥ä»¥ç¡®ä¿æ‰€æä¾›çš„å‚æ•°æ˜¯å¯è¿­ä»£çš„ã€‚ä¸ºäº†é˜²æ­¢å®ƒè¢«æ¶ˆè€—ï¼Œä¸ä¼šæ€¥åˆ‡åœ°å¯¹ç”Ÿæˆçš„å€¼è¿›è¡ŒéªŒè¯ã€‚</span>
m = Model(infinite=infinite_ints())
<span class="hljs-built_in">print</span>(m)
<span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">infinite=ValidatorIterator(index=0, schema=Some(Int(IntValidator &#123; strict: false &#125;)))</span>
<span class="hljs-string">&quot;&quot;&quot;</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m.infinite:
    <span class="hljs-built_in">print</span>(i)
    <span class="hljs-comment">#&gt; 0</span>
    <span class="hljs-comment">#&gt; 1</span>
    <span class="hljs-comment">#&gt; 2</span>
    <span class="hljs-comment">#&gt; 3</span>
    <span class="hljs-comment">#&gt; 4</span>
    <span class="hljs-comment">#&gt; 5</span>
    <span class="hljs-comment">#&gt; 6</span>
    <span class="hljs-comment">#&gt; 7</span>
    <span class="hljs-comment">#&gt; 8</span>
    <span class="hljs-comment">#&gt; 9</span>
    <span class="hljs-comment">#&gt; 10</span>
    <span class="hljs-keyword">if</span> i == <span class="hljs-number">10</span>:
        <span class="hljs-keyword">break</span>
</code></pre><h2 id="Pydantic-BaseModel"><a href="#Pydantic-BaseModel" class="headerlink" title="Pydantic BaseModel"></a>Pydantic BaseModel</h2><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
 <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
 name: <span class="hljs-built_in">str</span></code></pre><h3 id="Validator-éªŒè¯å™¨"><a href="#Validator-éªŒè¯å™¨" class="headerlink" title="Validator éªŒè¯å™¨"></a>Validator éªŒè¯å™¨</h3><p>Field validators å­—æ®µéªŒè¯å™¨ï¼š</p><p>å¦‚æœæ‚¨æƒ³å°†éªŒè¯å™¨é™„åŠ åˆ°æ¨¡å‹çš„ç‰¹å®šå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨Â <code>@field_validator</code>Â è£…é¥°å™¨ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°å€¼æ˜¯Â <code>UserModel</code>Â ç±»ï¼Œè€Œä¸æ˜¯Â <code>UserModel</code>Â çš„å®ä¾‹ã€‚æ‰€ä»¥åœ¨Â <code>@field_validator</code>Â è£…é¥°å™¨ä¸‹æ–¹ä½¿ç”¨Â <code>@classmethod</code>Â è£…é¥°å™¨æ¥è¿›è¡Œæ­£ç¡®çš„ç±»å‹æ£€æŸ¥ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦éªŒè¯çš„å­—æ®µå€¼ï¼›å¯ä»¥éšæ„å‘½åã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯Â <code>pydantic.FieldValidationInfo</code>Â çš„å®ä¾‹ï¼Œç”¨äºè®°å½•éªŒè¯çš„ä¿¡æ¯ã€‚</li><li>éªŒè¯å™¨åº”è¯¥è¿”å›è§£æçš„å€¼æˆ–å¼•å‘Â <code>ValueError</code>Â æˆ–Â <code>AssertionError</code>ï¼Œä¹Ÿå¯ä»¥æ— è„‘ <code>assert</code></li></ul><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> (
    BaseModel,
    FieldValidationInfo, <span class="hljs-comment"># å­—æ®µéªŒè¯çš„ä¿¡æ¯</span>
    ValidationError,
    field_validator,
)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>

 <span class="hljs-comment"># éªŒè¯åå­—</span>
<span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&#x27;name&#x27;</span></span>)</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name_must_contain_space</span>(<span class="hljs-params">cls, v: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> v:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;must contain a space&#x27;</span>)
        <span class="hljs-keyword">return</span> v.title()

    <span class="hljs-comment"># you can select multiple fields, or use &#x27;*&#x27; to select all fields</span>
<span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span></span>)</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_alphanumeric</span>(<span class="hljs-params">cls, v: <span class="hljs-built_in">str</span>, info: FieldValidationInfo</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(v, <span class="hljs-built_in">str</span>):
            <span class="hljs-comment"># info.field_name is the name of the field being validated</span>
            is_alphanumeric = v.replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).isalnum()
            <span class="hljs-keyword">assert</span> is_alphanumeric, <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;info.field_name&#125;</span> must be alphanumeric&#x27;</span>
        <span class="hljs-keyword">return</span> v
</code></pre><p>model_validator æ¨¡å‹éªŒè¯å™¨ï¼Œé’ˆå¯¹æ•´ä¸ªæ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œå¹¶æä¾›å‡ ä¸ª Hook é’©å­ï¼Œå¯ç”¨æ¥é¢„å¤„ç†éƒ¨åˆ†æ•°æ®ã€‚åŠ¡å¿… return å‡ºå¤„ç†å®Œçš„æ•´ä¸ªæ•°æ®ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, ValidationError, model_validator


<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span>
    password1: <span class="hljs-built_in">str</span>
    password2: <span class="hljs-built_in">str</span>

 <span class="hljs-comment"># åœ¨è¿›å…¥æ¨¡å‹ä¹‹å‰å¤„ç†</span>
<span class="hljs-meta">    @model_validator(<span class="hljs-params">mode=<span class="hljs-string">&#x27;before&#x27;</span></span>)</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_card_number_omitted</span>(<span class="hljs-params">cls, data: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(data, <span class="hljs-built_in">dict</span>):
            <span class="hljs-keyword">assert</span> (
                <span class="hljs-string">&#x27;card_number&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data
            ), <span class="hljs-string">&#x27;card_number should not be included&#x27;</span>
        <span class="hljs-keyword">return</span> data

 <span class="hljs-comment"># åœ¨è¿›å…¥æ¨¡å‹å¤„ç†ä¹‹åè¿è¡Œï¼Œåªåœ¨æ¨¡å‹æˆåŠŸéªŒè¯åå¤„ç†ã€‚</span>
<span class="hljs-meta">    @model_validator(<span class="hljs-params">mode=<span class="hljs-string">&#x27;after&#x27;</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_passwords_match</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-string">&#x27;UserModel&#x27;</span>:
        pw1 = self.password1
        pw2 = self.password2
        <span class="hljs-keyword">if</span> pw1 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pw2 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pw1 != pw2:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;passwords do not match&#x27;</span>)
        <span class="hljs-keyword">return</span> self</code></pre><h3 id="Field-è‹±-fi-ld-å­—æ®µ"><a href="#Field-è‹±-fi-ld-å­—æ®µ" class="headerlink" title="Field [è‹± &#x2F;fi:ld&#x2F; å­—æ®µ]"></a>Field [è‹± &#x2F;fi:ld&#x2F; å­—æ®µ]</h3><p><code>Field</code>Â å‡½æ•°ç”¨äºè‡ªå®šä¹‰å…ƒæ•°æ®å¹¶å°†å…¶æ·»åŠ åˆ°æ¨¡å‹çš„å­—æ®µä¸­ã€‚ç”¨äºæ”¹å˜ Pydantic çš„è¡Œä¸ºã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field


<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
 <span class="hljs-comment"># æä¾›é»˜è®¤å€¼</span>
    name: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">&#x27;John Doe&#x27;</span>)
 <span class="hljs-comment"># æä¾› factory function ç”Ÿæˆé»˜è®¤æ•°æ®</span>
 <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Field(default_factory=<span class="hljs-keyword">lambda</span>: uuid4().<span class="hljs-built_in">hex</span>)
 <span class="hljs-comment"># alias åˆ«å</span>
 ...
 <span class="hljs-comment"># constrain çº¦æŸ gt/lt/ge é™åˆ¶å¤§å°</span>
 ...
 <span class="hljs-comment">#</span></code></pre><h3 id="åºåˆ—åŒ–-Serialization-è‹±-ËˆsÉªÉ™ri-É™ËŒlaÉªz"><a href="#åºåˆ—åŒ–-Serialization-è‹±-ËˆsÉªÉ™ri-É™ËŒlaÉªz" class="headerlink" title="åºåˆ—åŒ– Serialization [è‹± &#x2F;ËˆsÉªÉ™ri:É™ËŒlaÉªz&#x2F;]"></a>åºåˆ—åŒ– Serialization [è‹± &#x2F;ËˆsÉªÉ™ri:É™ËŒlaÉªz&#x2F;]</h3><pre><code class="hljs python">m.model_dump() <span class="hljs-comment"># å¯¼å‡º Python ç±»å‹</span>
m.model_dump_json() <span class="hljs-comment"># å¯¼å‡º Json ç±»å‹</span></code></pre><h2 id="Read-Environment-value-IN-BaseSettings-ä½¿ç”¨-Pydantic-ç®¡ç†ç¯å¢ƒå˜é‡"><a href="#Read-Environment-value-IN-BaseSettings-ä½¿ç”¨-Pydantic-ç®¡ç†ç¯å¢ƒå˜é‡" class="headerlink" title="Read Environment value IN BaseSettings ä½¿ç”¨ Pydantic ç®¡ç†ç¯å¢ƒå˜é‡"></a>Read Environment value IN BaseSettings ä½¿ç”¨ Pydantic ç®¡ç†ç¯å¢ƒå˜é‡</h2><p>é…ç½®ä¸€ä¸ª Python ç¨‹åºçš„æœ€ä½³å®è·µä¸æ˜¯ç¼–å†™å¤æ‚çš„è§£æé€»è¾‘æ¥è§£æ ini yaml ç­‰é…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ç¯å¢ƒå˜é‡è¯»å–ã€‚ä½¿ç”¨ <code>pydantic-settings</code> å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»ç¯å¢ƒå˜é‡é‡Œè¯»å–é…ç½®ä¿¡æ¯ã€‚</p><ul><li>åˆ›å»ºä¸€ä¸ªå®šä¹‰æ˜ç¡®ã€ç±»å‹æç¤ºçš„åº”ç”¨ç¨‹åºé…ç½®ç±»</li><li>è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–å¯¹é…ç½®çš„ä¿®æ”¹</li></ul><p>installï¼šå®‰è£…</p><pre><code class="hljs python">pip install pydantic-settings</code></pre><p>ç¤ºä¾‹ï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Callable</span>, <span class="hljs-type">Set</span>

<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> (
    AliasChoices,
    AmqpDsn,
    BaseModel,
    Field,
    ImportString,
    PostgresDsn,
    RedisDsn,
)

<span class="hljs-keyword">from</span> pydantic_settings <span class="hljs-keyword">import</span> BaseSettings, SettingsConfigDict


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SubModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    foo: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;bar&#x27;</span>
    apple: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
 <span class="hljs-comment"># é…ç½® alias å®é™…è¯»å– `my_auth_key` ç¯å¢ƒå˜é‡</span>
    auth_key: <span class="hljs-built_in">str</span> = Field(validation_alias=<span class="hljs-string">&#x27;my_auth_key&#x27;</span>)

    api_key: <span class="hljs-built_in">str</span> = Field(alias=<span class="hljs-string">&#x27;my_api_key&#x27;</span>)

    redis_dsn: RedisDsn = Field(
        <span class="hljs-string">&#x27;redis://user:pass@localhost:6379/1&#x27;</span>,
        validation_alias=AliasChoices(<span class="hljs-string">&#x27;service_redis_dsn&#x27;</span>, <span class="hljs-string">&#x27;redis_url&#x27;</span>),  (<span class="hljs-number">3</span>)
    )
    pg_dsn: PostgresDsn = <span class="hljs-string">&#x27;postgres://user:pass@localhost:5432/foobar&#x27;</span>
    amqp_dsn: AmqpDsn = <span class="hljs-string">&#x27;amqp://user:pass@localhost:5672/&#x27;</span>

    special_function: ImportString[<span class="hljs-type">Callable</span>[[<span class="hljs-type">Any</span>], <span class="hljs-type">Any</span>]] = <span class="hljs-string">&#x27;math.cos&#x27;</span>  (<span class="hljs-number">4</span>)

    <span class="hljs-comment"># to override domains:</span>
    <span class="hljs-comment"># export my_prefix_domains=&#x27;[&quot;foo.com&quot;, &quot;bar.com&quot;]&#x27;</span>
    domains: <span class="hljs-type">Set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()

    <span class="hljs-comment"># to override more_settings:</span>
    <span class="hljs-comment"># export my_prefix_more_settings=&#x27;&#123;&quot;foo&quot;: &quot;x&quot;, &quot;apple&quot;: 1&#125;&#x27;</span>
    more_settings: SubModel = SubModel()

 <span class="hljs-comment"># model é…ç½®ï¼Œä¸ºæ‰€æœ‰ç¯å¢ƒå˜é‡è®¾ç½® prefix [è‹± /&#x27;priËfÉªks/]</span>
    model_config = SettingsConfigDict(env_prefix=<span class="hljs-string">&#x27;my_prefix_&#x27;</span>)  (<span class="hljs-number">5</span>)


<span class="hljs-built_in">print</span>(Settings().model_dump())
<span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">&#123;</span>
<span class="hljs-string">    &#x27;auth_key&#x27;: &#x27;xxx&#x27;,</span>
<span class="hljs-string">    &#x27;api_key&#x27;: &#x27;xxx&#x27;,</span>
<span class="hljs-string">    &#x27;redis_dsn&#x27;: Url(&#x27;redis://user:pass@localhost:6379/1&#x27;),</span>
<span class="hljs-string">    &#x27;pg_dsn&#x27;: MultiHostUrl(&#x27;postgres://user:pass@localhost:5432/foobar&#x27;),</span>
<span class="hljs-string">    &#x27;amqp_dsn&#x27;: Url(&#x27;amqp://user:pass@localhost:5672/&#x27;),</span>
<span class="hljs-string">    &#x27;special_function&#x27;: math.cos,</span>
<span class="hljs-string">    &#x27;domains&#x27;: set(),</span>
<span class="hljs-string">    &#x27;more_settings&#x27;: &#123;&#x27;foo&#x27;: &#x27;bar&#x27;, &#x27;apple&#x27;: 1&#125;,</span>
<span class="hljs-string">&#125;</span>
<span class="hljs-string">&quot;&quot;&quot;</span></code></pre><h3 id="é€šè¿‡-env-æ–‡ä»¶åŠ è½½"><a href="#é€šè¿‡-env-æ–‡ä»¶åŠ è½½" class="headerlink" title="é€šè¿‡ .env æ–‡ä»¶åŠ è½½"></a>é€šè¿‡ .env æ–‡ä»¶åŠ è½½</h3><p>ç¯å¢ƒå˜é‡çš„ä¼˜å…ˆçº§ï¼.env æ–‡ä»¶</p><p>.env file:</p><pre><code class="hljs text"># ignore comment
ENVIRONMENT=&quot;production&quot;
REDIS_ADDRESS=localhost:6379
MEANING_OF_LIFE=42
MY_VAR=&#x27;Hello world&#x27;
</code></pre><p>åœ¨ model_config å¤„åŠ è½½ï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic_settings <span class="hljs-keyword">import</span> BaseSettings, SettingsConfigDict


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
    model_config = SettingsConfigDict(env_file=<span class="hljs-string">&#x27;.env&#x27;</span>, env_file_encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)
</code></pre><p>å®ä¾‹åŒ–å¯¹è±¡åŠ è½½ï¼š</p><pre><code class="hljs python">settings = Settings(_env_file=<span class="hljs-string">&#x27;prod.env&#x27;</span>, _env_file_encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)</code></pre></div><div class="post__license"><p><strong>Author: </strong>WhaleFall</p><p><strong>Permalink: </strong><a href="https://www.whaleluo.top/python/python-pydantic-tutorial/">https://www.whaleluo.top/python/python-pydantic-tutorial/</a></p><strong><p>æ–‡ç« é»˜è®¤ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> åè®®è¿›è¡Œè®¸å¯ï¼Œä½¿ç”¨æ—¶è¯·æ³¨æ„éµå®ˆåè®®ã€‚</p></strong></div><div class="post-footer__meta"><p>updated at 2023-09-24</p></div><div class="post-entry__tags"></div></article><div class="nav"><div class="nav__prev"><a href="/router-experiment/" class="nav__link"><div><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624L310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg></div><div><div class="nav__label">Previous Post</div><div class="nav__title">å„ç§è·¯ç”±å™¨æŠ˜è…¾æ—¥è®°</div></div></a></div><div class="nav__next"><a href="/china-documentary/" class="nav__link"><div><div class="nav__label">Next Post</div><div class="nav__title">çºªå®ã€æ·±åº¦ã€å†·é—¨â€”â€”ä¸­å›½ç‹¬ç«‹çºªå½•ç‰‡æ¨è</div></div><div><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg></div></a></div></div><div class="post__comments post__with-toc content-card" id="comment"><h4>Comments</h4><div id="gitalk-container"></div></div></main><footer class="footer"><a href="#" class="button" id="b2t" aria-label="Back to Top" title="Back to Top"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="32" height="32"><path d="M233.376 722.752L278.624 768 512 534.624 745.376 768l45.248-45.248L512 444.128zM192 352h640V288H192z" fill="currentColor"></path></svg> </a><span id="busuanzi_container_site_uv" hidden><span></span> <span id="busuanzi_value_site_uv"></span> <span>Viewers</span> <span>|</span> </span><span id="busuanzi_container_site_pv" hidden><span></span> <span id="busuanzi_value_site_pv"></span> <span>Views</span></span><p class="footer-copyright">Copyright Â© 2018&nbsp;-&nbsp;2024 <a href="/">ğŸ˜Šè½è½ã®BlogğŸ˜Š</a></p><p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p></footer></div><script defer src="https://api.whaleluo.top/file/?url=https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:0}</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "e052e3fc47004feab6ae8122cfeec660"}'></script><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script>let lazyloadT = Boolean('true'),
            auto_fancybox = Boolean('true')
        if (auto_fancybox) {
            $(".post__content").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        } else {
            $(".post__content").find("fancybox").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        }</script><script>function loadComment() {
            let e, i;
            (e = document.createElement("script")).src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js',
            document.body.appendChild(e);
            e.onload = () => {
                var gitalk = new Gitalk({
                    clientID: 'b2fd920dada050fed5b3',
                    clientSecret: '5c847cefe7df2df634886eafa178877899404378',
                    repo: 'WhaleFell.github.io',
                    owner: 'WhaleFell',
                    admin: 'WhaleFell',
                    id: window.location.pathname,
                    distractionFreeMode: false
                });
                gitalk.render('gitalk-container');
            };
            (i = document.createElement("link")).rel = "stylesheet",
            i.href = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css',
            document.head.appendChild(i);
        }
    
        var runningOnBrowser = typeof window !== "undefined";
        var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
        var supportsIntersectionObserver = runningOnBrowser && "IntersectionObserver" in window;
    
        setTimeout(function () {
            if (!isBot && supportsIntersectionObserver) {
                var comment_observer = new IntersectionObserver(function(entries) {
                    if (entries[0].isIntersecting) {
                        loadComment();
                        comment_observer.disconnect();
                    }
                }, { threshold: [0] });
                comment_observer.observe(document.getElementById('comment'));
            } else {
                loadComment();
            }
        }, 1);</script></body></html>